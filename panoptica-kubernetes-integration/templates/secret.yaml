{{- if .Values.global.deploymentHooks.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "panoptica-kubernetes-integration.fullname" . }}-pre-sync
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "panoptica-kubernetes-integration.labels" . | nindent 4 }}
  annotations:
    argocd.argoproj.io/hook: PreSync
type: panoptica.app/release
data:
  chartValues: {{ toYaml $.Values | b64enc }}
  chartVersion: {{ .Chart.Version | b64enc }}
  deploymentStatus: {{ printf "%s" "installing" | b64enc }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "panoptica-kubernetes-integration.fullname" . }}-post-sync
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "panoptica-kubernetes-integration.labels" . | nindent 4 }}
  annotations:
    argocd.argoproj.io/hook: PostSync
type: panoptica.app/release
data:
  chartValues: {{ toYaml $.Values | b64enc }}
  chartVersion: {{ .Chart.Version | b64enc }}
  deploymentStatus: {{ printf "%s" "deployed" | b64enc }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "panoptica-kubernetes-integration.fullname" . }}-sync-fail
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "panoptica-kubernetes-integration.labels" . | nindent 4 }}
  annotations:
    argocd.argoproj.io/hook: SyncFail
type: panoptica.app/release
data:
  chartValues: {{ toYaml $.Values | b64enc }}
  chartVersion: {{ .Chart.Version | b64enc }}
  deploymentStatus: {{ printf "%s" "failed" | b64enc }}
---
{{- else }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "panoptica-kubernetes-integration.fullname" . }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "panoptica-kubernetes-integration.labels" . | nindent 4 }}
type: panoptica.app/release
data:
  chartValues: {{ toYaml $.Values | b64enc }}
  chartVersion: {{ .Chart.Version | b64enc }}
  deploymentStatus: {{ printf "%s" "untrackable" | b64enc }}
  deploymentStatusMessage: {{ printf "%s" "xxxx" | b64enc }}
---
{{- end }}
